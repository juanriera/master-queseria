---
lang: es
---

# La exploraci칩n de los datos mediante gr치ficos.

En este cap칤tulo estudiaremos c칩mo describir conjuntos de datos de forma visual, utilizando varios tipos de gr치ficos distintos:

-   *Stemplot*
-   Histograma
-   Diagrama de caja o *boxplot*
-   Gr치fico de dispersi칩n
-   Gr치fico de series temporales

Veremos la relaci칩n visual entre un histograma y un diagrama de caja, y aprenderemos tambi칠n a construir tablas de frecuencias en Excel y en `Python`. Finalmente, veremos algunos otros tipos de gr치ficos que son 칰tiles para aplicaciones concretas, como los gr치ficos de densidad.

Utilizaremos dos grupos de datos,

\- las alturas de un grupo de alumnos y alumnas, recogidos en un fichero CSV denominado \`aula1.csv\`,

\- los datos anal칤ticos de una fabricaci칩n de camembert a lo largo de un a침o, recogidos en un fichero CSV denominado \`camembert.csv\`

## Explorando los datos

### El diagrama de tallo y hojas (*stem and leaf plot* o *stemplot*)

El diagrama de tallo y hojas, tambi칠n conocido como *stemplot*, es una herramienta gr치fica utilizada en estad칤stica para representar la distribuci칩n de un conjunto de datos. Es especialmente 칰til para conjuntos de datos peque침os y proporciona una forma r치pida y efectiva de visualizar la forma de los datos y su dispersi칩n. El *stemplot* recibe este nombre porque el dibujo que resulta se asemeja a un tallo el que le salen las hojas que son los datos individuales.

Los componentes de un *stemplot* son:

-   **Tallo**: Representa el grupo principal de los valores de los datos. Generalmente, se usa la parte m치s significativa del n칰mero. Por ejemplo, en el n칰mero 43, el tallo podr칤a ser 4.

-   **Hojas**: Representan los d칤gitos finales o menos significativos de los valores de los datos. Siguiendo el ejemplo anterior, la hoja ser칤a 3.

#### Construcci칩n del diagrama en la hoja de c치lculo

Supongamos que queremos medir la altura de un grupo de alumnos de nuestra clase. 칄ste es nuestro grupo:

![](01-imagenes/grupo1.jpg)

Realizamos la medida de altura de cada persona y registramos los valores en una hoja de c치lculo, siguiendo las buenas pr치cticas que hemos visto al estudiar los *datos ordenados*.

![](01-imagenes/aula1.png)

Vamos a utilizar los datos de medidas de altura de nuestro grupo de alumnos. Quitamos el 칰ltimo d칤gito a la derecha de nuestros valores y colocamos verticalmente los valores resultantes orden치ndolos de menor a mayor, y evitando las repeticiones. Para evitar errores en la escala, debemos incluir los valores intermedios aunque no haya ninguno en nuestros datos (en el ejemplo, el valor 16 que corresponder칤a a los 160). Esto forma el "tallo" de nuestro diagrama:

![](01-imagenes/aula1-stemplot-paso1.png)

A continuaci칩n a침adimos las "hojas" en la celda a la derecha, que consisten en los valores que hemos "cortado" de nuestro 치rbol, uno al lado de otro, incluyendo esta vez los valores repetidos, en orden de menor a mayor. Por ejemplo, para el valor 135, descartamos 13 y utlizamos 5; para el valor 138, descartamos 13 y utilizamos 8, y as칤 sucesivamente para todos los valores.

![](01-imagenes/aula1-stemplot-paso2.png)

### Interpretaci칩n del diagrama de tallo y hojas

-   **Tallo**: Los n칰meros a la izquierda del s칤mbolo `|` representan los valores base (o tallos), en este caso, las decenas de las alturas.
-   **Hojas**: Los n칰meros a la derecha del s칤mbolo `|` representan los d칤gitos adicionales (o hojas). Por ejemplo, en la l칤nea `13 | 58`, el tallo es `13` (130), y las hojas son `5` y `8`, que corresponden a los datos `135` y `138`.

El diagrama nos dice que los valores en torno a 150 cm son los m치s frecuentes, y que hay un valor alto (175) que se separa un poco del resto.

### Resumen

El *stemplot* es muy sencillo de hacer y nos da una visi칩n r치pida y compacta de la *distribuci칩n* de nuestros valores, as칤 como de la posible existencia de valores que se separan del conjunto. Estos valores alejados, que se conocen en ingl칠s como *outliers*, tienen mucha importancia en el analisis e interpretaci칩n de los datos, como veremos m치s adelante.

La ventaja principal del *stemplot* es que mantiene los valores originales de las observaciones, y puede hacerse f치cilmente con bol칤grafo y papel, sin necesidad de m치s herramientas.

Su principal inconveniente es la elaboraci칩n manual (aunque lenguajes como R tienen funciones que lo contruyen de forma autom치tica), y por lo tanto, la dificultad de aplicarlo a volumenes de datos medios o grandes. El uso generalizado de los ordenadores ha hecho que actualmente esta herramienta tenga muy poco uso, y se utilicen en su lugar otras m치s gr치ficas y de construcci칩n autom치tica, como el **histograma**.

## Distribuciones de frecuencias

Una **distribuci칩n de frecuencias** es una tabla que muestra la frecuencia con la que ocurren los valores diferentes en un conjunto de datos. Esta herramienta es fundamental en la estad칤stica descriptiva y permite resumir y visualizar c칩mo se distribuyen los datos de manera clara y comprensible. A partir de una tabla de frecuencias se pueden construir diagramas de barra o histogramas para visualizar la tabla de forma gr치fica.

Para construir una distribuci칩n de frecuencias, agrupamos nuestros valores por intervalos, y contamos el n칰mero de observaciones que aparecen en cada intervalo. Los componentes de una distribuci칩n de frecuencias son:

-   las **categor칤as o clases** son los intervalos o valores espec칤ficos de los datos que se est치n analizando. Cada categor칤a representa un rango de valores en caso de datos continuos, o valores espec칤ficos en caso de datos discretos.
-   la **frecuencia absoluta** es un *recuento simple* de cu치ntas veces aparece cada valor en un conjunto de datos.
-   la **frecuencia relativa** nos muestra la *proporci칩n* de cada valor frente al total. Puede expresarse como fracci칩n (entre 0 y 1) o como porcentaje (respecto a 100), y se calcula como: $$
     \text{Frecuencia Relativa} = \frac{\text{Frecuencia Absoluta}}{\text{N칰mero Total de Observaciones}}
     $$
-   la **frecuencia acumulada** nos dice cu치ntas observaciones est치n por debajo de un cierto valor.
-   la **frecuencia relativa acumulada** es la proporci칩n de valores que est치n por debajo de un cierto valor

### Construcci칩n en Excel

La tabla a continuaci칩n muestra una distribuci칩n de frecuencias de las alturas de nuestro grupo de alumnos, calculada mediante una tabla din치mica de Excel.

## Instrucciones paso a paso en Excel

Para crear una tabla de frecuencias de la variable `altura_cm` mediante tablas din치micas en Excel, sigue estos pasos:

**1. Selecciona los Datos**

1.  Abre tu archivo de Excel y selecciona toda la tabla que incluye los encabezados (`nombre` y `altura_cm`).

**2. Inserta una tabla din치mica**

1.  Ve a la pesta침a **Insertar** en la barra de herramientas de Excel.
2.  Haz clic en **Tabla Din치mica**.
3.  En el cuadro de di치logo que aparece, aseg칰rate de que el rango de datos seleccionado es correcto y elige d칩nde deseas colocar la tabla din치mica (en una nueva hoja de c치lculo o en la hoja actual).

**3. A침ade la frecuencia absoluta**

1.  En el panel de campos de la tabla din치mica, arrastra el campo `altura_cm` a la secci칩n **Filas**.
2.  Arrastra nuevamente el campo `altura_cm` a la secci칩n **Valores**.

**4. Ajusta la configuraci칩n de valores**

1.  Haz clic en el campo `altura_cm` en la secci칩n **Valores**.
2.  Selecciona **Configuraci칩n de campo de valor**.
3.  En el cuadro de di치logo que aparece, aseg칰rate de que est칠 seleccionada la opci칩n **Recuento**
4.  Acepta todo hasta volver a Excel.

**5. A침ade la frecuencia relativa**

1.  En el panel de campos de la tabla din치mica, arrastra de nuevo el campo `altura_cm` a la secci칩n **Valores**. Ahora la variable aparecer치 como `altura_cm2`.

**6. Ajusta de nuevo la configuraci칩n de valores**

1.  Haz clic en el campo `altura_cm2` en la secci칩n **Valores**.
2.  Selecciona **Configuraci칩n de campo de valor**.
3.  En el cuadro de di치logo que aparece, aseg칰rate de que est칠 seleccionada la opci칩n **Recuento**.
4.  En ese mismo cuadro, haz click en el bot칩n **Formato de n칰mero**, selecciona **N칰mero** y **2 decimales**, y acepta.
5.  En ese mismo cuadro, selecciona la pesta침a que dice **Mostrar valores como**
6.  En el men칰 desplegable, escoge la opci칩n **% del total de columnas**.
7.  Acepta todo hasta volver a Excel.

**7. Ordena y formatea**

1.  Puedes ordenar las alturas en orden ascendente o descendente haciendo clic en la flecha junto a `altura_cm` en la tabla din치mica.
2.  Tambi칠n puedes cambiar el formato de la tabla din치mica para que sea m치s f치cil de leer.
3.  Puedes renombrar los encabezados de la tabla para que sea m치s f치cil de leer, rotulando las columnas, por ejemplo, como `frec_abs`y `frec_rel`, o cualquier otro encabezado que te resulte claro y 칰til.

![](01-imagenes/aula1-td-frec.png)

Tambi칠n podemos calcular las frecuencias absolutas de nuestra tabla en `Python`, de forma bastante sencilla, sin agrupar.

```{python}
import pandas as pd

altura_cm = [153,135,140,140,175,138,145,154,152,159,154]
frecuencias = pd.Series(altura_cm).value_counts()
print(frecuencias)

```

Con un poco m치s de c칩digo podemos hacer la tabla agrupando los valores en clases de amplitud 10, con las frecuencias absolutas y relativas. Es un poco m치s complicado, t칩mate tu tiempo para entender cada paso de las instrucciones.

```{python}
import pandas as pd
import numpy as np

altura_cm = [153,135,140,140,175,138,145,154,152,159,154]
serie = pd.Series(altura_cm)

# Crear intervalos autom치ticamente con amplitud 10
bins = np.arange(min(altura_cm)//10*10, max(altura_cm)//10*10 + 20, 10)

# Agrupar y contar
tabla = pd.cut(serie, bins=bins).value_counts(sort=False)

# Convertir a DataFrame con acumulados y relativos
df = tabla.to_frame(name='Frecuencia')
df['Frecuencia acumulada'] = df['Frecuencia'].cumsum()
df['Frecuencia relativa (%)'] = (df['Frecuencia'] / df['Frecuencia'].sum() * 100).round(2)
df['Acumulada (%)'] = df['Frecuencia relativa (%)'].cumsum()

print(df)
```

Vamos a explicar el c칩digo l칤nea a l칤nea.

---

Este script en `Python` construye una tabla de frecuencias agrupadas a partir de un conjunto de datos num칠ricos (`altura_cm`), usando `pandas` y `numpy`.

```python
import pandas as pd
import numpy as np
```
游댳 Importa las bibliotecas necesarias:
- `pandas`: para manipulaci칩n tabular.
- `numpy`: para c치lculos num칠ricos y generaci칩n de rangos.

---

```python
altura_cm = [153,135,140,140,175,138,145,154,152,159,154]
```
游댳 Define el conjunto de datos como una lista de alturas en cent칤metros.

---

```python
serie = pd.Series(altura_cm)
```
游댳 Convierte la lista en una `Series` de pandas, lo que permite aplicar funciones estad칤sticas f치cilmente.

---

```python
bins = np.arange(min(altura_cm)//10*10, max(altura_cm)//10*10 + 20, 10)
```
游댳 Genera los l칤mites de clase con amplitud 10:
- `min(altura_cm)//10*10`: redondea hacia abajo el m칤nimo a la decena m치s cercana.
- `max(altura_cm)//10*10 + 20`: redondea hacia arriba el m치ximo y a침ade 10 extra para incluir el 칰ltimo dato.
- `np.arange(...)`: crea un array de l칤mites desde el m칤nimo hasta el m치ximo, en pasos de 10.

游늷 Ejemplo de salida: `[130, 140, 150, 160, 170, 180]`

---

```python
tabla = pd.cut(serie, bins=bins).value_counts(sort=False)
```
游댳 Agrupa los datos en los intervalos definidos:
- `pd.cut(...)`: asigna cada dato a un intervalo.
- `.value_counts(sort=False)`: cuenta cu치ntos datos hay en cada intervalo, sin reordenarlos.

---

```python
df = tabla.to_frame(name='Frecuencia')
```
游댳 Convierte la serie de frecuencias en un `DataFrame` con una columna llamada `'Frecuencia'`.

---

```python
df['Frecuencia acumulada'] = df['Frecuencia'].cumsum()
```
游댳 Calcula la frecuencia acumulada sumando progresivamente los valores de la columna `'Frecuencia'`.

---

```python
df['Frecuencia relativa (%)'] = (df['Frecuencia'] / df['Frecuencia'].sum() * 100).round(2)
```
游댳 Calcula la frecuencia relativa en porcentaje:
- Divide cada frecuencia por el total.
- Multiplica por 100.
- Redondea a 2 decimales.

---

```python
df['Acumulada (%)'] = df['Frecuencia relativa (%)'].cumsum()
```
游댳 Calcula el porcentaje acumulado, 칰til para an치lisis tipo Pareto.

---

```python
print(df)
```
游댳 Muestra la tabla final con:
- Intervalos
- Frecuencia absoluta
- Frecuencia acumulada
- Frecuencia relativa (%)
- Porcentaje acumulado

---

Como ves en el resultado, a veces se utilizan los s칤mbolos `(` y `[` para definir los intervalos, tal como se hace en matem치ticas.

-   Intervalo **abierto**: El s칤mbolo `(` se utiliza para denotar un intervalo abierto. El l칤mite correspondiente **no** est치 incluuido en el intervalo.
-   Intervalo **cerrado o semiabierto**:El s칤mbolo `[` se utiliza para denotar un intervalo cerrado o semiabierto. EL l칤mite correspondiente **s칤** est치 incluido en el intervalo.

Ejemplos:

-   $(a, b)$ representa todos los n칰meros reales **mayores** que $a$ y **menores** que $b$ (excluye los valores $a$ y $b$).
-   $[a, b]$ representa todos los n칰meros reales **mayores o iguales** que $a$ y **menores o iguales** que $b$ (incluye $a$ y $b$).
-   $[a, b)$ representa todos los n칰meros reales **mayores o iguales** que $a$ y **menores** que $b$ (incluye $a$, pero excluye $b$)
-   $(a, b]$ representa todos los n칰meros reales **mayores** que $a$ y **menores o iguales** que $b$ (excluye $a$, pero incluye $b$). :::

Si comparamos los dos m칠todos que hemos utilizado para construir la tabla de frecuencias, vemos que:

-   en Excel los pasos que hemos dado no est치n registrados y a la vista, y, por lo tanto, no son f치cilmente revisables
-   en `Python`, todos los pasos y opciones que hemos utilizado est치n a la vista en el c칩digo del script

Si otra persona quisiera modificar la tabla, le ser칤a f치cil editar el c칩digo y relanzar el script, mientras que en Excel no ser칤a f치cil asegurarse de todos y cada uno de los pasos y clicks de rat칩n que hemos dado para construir y formatear la tabla.

Es el caso, por ejemplo, de que envi치semos la tabla a otra persona y 칠sta tuviese que editarla en nuestra ausencia. En Excel, tendr칤amos que enviar a esa persona una explicaci칩n con las instrucciones oportunas; en cambio, en `Python`, una vez que se comprende el c칩digo, no hacen falta m치s explicaciones adicionales. Incluso sin una comprensi칩n total del c칩digo, se podr칤a duplicar exactamente la tabla copiando y ejecutando el c칩digo.

Esta es una de las principales razones de la conveniencia del aprendizaje de `Python` incluso para las actividades m치s sencillas.

## Ejercicio propuesto

En la tabla de frecuencias anterior, calcular **frecuencia absoluta acumulada** y **frecuencia relativa acumulada** en Excel, e incluirlas en la tabla como dos columnas adicionales. La **frecuencia relativa acumulada** nos permitir치 crear **diagramas de Pareto**, muy 칰tiles en los procesos de mejora de calidad.

## Diagrama de barras

Cuando nuestra variable es *discreta*, podemos representar las frecuencias de cada valor de forma gr치fica utilizando un diagrama de barras. Este diagrama utiliza barras rectangulares para representar la frecuencia de cada categor칤a.

Este gr치fico es muy utilizado para representar, por ejemplo, resultados de encuestas, como el n칰mero de votos que han obtenido los diferentes partidos pol칤ticos en unas elecciones, o tablas discretas, como los kilos fabricados por meses en una f치brica.

::: {layout="[[40,-20,40],[45,-10,45]]"}
![](01-imagenes/2024-12-07-excel-tabla-frec-1.png)

![](01-imagenes/2024-12-07-excel-tabla-frec-2.png)

![](01-imagenes/barras1.png)

![](01-imagenes/barras2.png)

Ejemplos de diagramas de barras
:::

## Histograma

Para visualizar las variables continuas se utiliza el **histograma**, que es un diagrama que utiliza las barras rectangulares para hacer un gr치fico de la distribuci칩n de valores continuos, previamente agrupados en intervalos (*bins* en ingl칠s), tal como se ha hecho en la tabla de frecuencias.

#### Componentes de un histograma

1.  **Eje horizontal (X)**: Representa los intervalos de valores de la variable. Cada intervalo abarca un rango espec칤fico de valores.
2.  **Eje vertical (Y)**: Muestra la frecuencia o el n칰mero de veces que los valores caen dentro de cada intervalo.
3.  **Barras**: Cada barra en el histograma representa un intervalo. La altura de la barra indica la frecuencia de los valores dentro de ese intervalo.

#### C칩mo interpretar un histograma

-   Si las barras son altas en un intervalo espec칤fico, significa que muchos valores del conjunto de datos caen dentro de ese rango.
-   Un histograma puede ayudar a identificar patrones, como si los datos est치n distribuidos de manera sim칠trica, sesgada, o si hay picos y valles significativos.

### Construcci칩n de un histograma en Excel

Usaremos el ejemplo de la altura en cm. de un grupo de alumnos, cuyos datos hemos guardado en el fichero csv `aula1.csv`.

Podemos utilizar dos m칠todos para hacer un histograma en Excel

#### M칠todo 1: histograma directo

-   Seleccionamos el rango de datos. Podemos hacerlo mediante un click en el encabezado de la columna de la variable `altura_cm`, en este caso, la columna `B`.
-   En la opci칩n de men칰 `Insertar`, seleccionamos el icono `Seleccionar gr치ficos de estad칤stica`
-   Seleccionamos `Histograma`

![](01-imagenes/excel-histo-aula1.png){fig-align="center" width="75%"}

Excel calcula autom치ticamente la amplitud de los intervalos y el n칰mero de columnas; estas opciones pueden modificarse seleccionando con el bot칩n derecho del rat칩n el elemento a modificar. En este caso, utilizamos estas opciones:

-   Eliminamos t칤tulo del gr치fico
-   Modificamos anchura de las barras seleccionando `Dar formato a serie de datos`, `Opciones de serie`, `Ancho del rango`= 50%
-   Modificamos los intervalos seleccionando el eje X: `Dar formato al eje`, `Opciones de eje`, `Ancho del rango` = 10

La descripci칩n de los intervalos utiliza los mismos s칤mbolos que hemos visto en las tablas de frecuencias de R.

En el momento de escribir este manual, Excel no permite hacer histogramas m칰ltiples ni agrupados por otra variable, por lo que para dise침os m치s complejos, no hay m치s remedio que recurrir a otras opciones como las tablas din치micas de Excel o, mejor a칰n, R.

#### M칠todo 2: utilizar una tabla din치mica

La tabla din치mica que hemos construido en Excel ha convertido nuestra variable continua, `altura_cm`, en una tabla de valores discretos, al agrupar los valores en intervalos. En Excel podemos representar las frecuencias absolutas de nuestra tabla gr치ficamente, insertando un gr치fico de barras a partir de la tabla:

-   Con el cursor dentro de la tabla, seleccionamos la opci칩n de men칰 `Insertar`
-   Insertamos un gr치fico de barras

Opcionalmente, aplicamos las siguientes opciones de formato:

-   Hacemos click sobre uno de los botones del gr치fico din치mico con el boton derecho del rat칩n, y seleccionamos la opci칩n ocultar todos los botones del gr치fico.
-   Eliminamos el t칤tulo del gr치fico
-   Abrimos el formato de la serie de datos, e introducimos en la opci칩n `Ancho del rango` el valor $50\%$ para ensanchar las barras.

![](01-imagenes/aula1-diag-barras.png){fig-align="center" width="75%"}

Al utiizar la tabla din치mica para construir el gr치fico, Excel utiliza las categor칤as de la tabla din치mica. Dado que estas categor칤as (los intervalos que ha formado la tabla din치mica) son discretas, Excel utiliza el resultado de la tabla din치mica para hacer el gr치fico con un diagrama de barras. No es posible insertar un histograma a partir de una tabla din치mica.

### An치lisis de un caso real

El histograma muestra su utilidad cuando representamos la distribuci칩n de un conjunto de valores m치s grande que nuestros once alumnos. Veamos su aplicaci칩n a los datos diarios de una fabricaci칩n de queso camembert a lo largo de un a침o.Los datos de esta fabricaci칩n est치n en el fichero `camembert.csv`.

La tabla de datos tiene esta estructura:

![](01-imagenes/camembert-tabla-datos.png){fig-align="center" width="75%"}

La tabla est치 formada por 211 casos.


#### Construcci칩n del histograma con Excel

##### M칠todo directo

Seleccionamos el rango del extracto seco (columna `est`) e insertamos el histograma, ajustando el ancho de intervalo a $1$ en las opciones de gr치fico:

![](01-imagenes/excel-histo.png){fig-align="center" width="75%"}

##### M칠todo 2: mediante una tabla din치mica

Los pasos a seguir son:

1.  Construir la tabla din치mica
2.  Agrupar los datos
3.  Insertar el gr치fico a partir de la tabla

Con una agrupaci칩n de datos en intervalos de 1, esta es nuestra tabla din치mica:

![](01-imagenes/camembert-td.png)

En la figura siguiente vemos el histograma correspondiente a la tabla anterior, con un intervalo de clase de 1 punto de extracto seco total, y otras dos alternativas si el intervalo de clase fuese de 2 puntos o de de 0,5 puntos.

::: {layout="[[1], [1,1]]"}
![](01-imagenes/camembert-histo1.png){fig-align="center" width="75%"}

![](01-imagenes/camembert-histo2.png)

![](01-imagenes/camembert-histo3.png)
:::

La decisi칩n de cambiar la amplitud del intervalo en un histograma influye en el aspecto del gr치fico y es una opci칩n personal; lo mejor es utilizar la que en nuestra opini칩n refleje mejor el aspecto de la distribuci칩n de datos, ni demasiado grande ni demasiado peque침a. En todo caso, debemos ser capaces de interpretar que la distribuci칩n de los valores es la misma en los tres casos: hay una mayor칤a de casos con valores entre 46 y 48, y muy pocos casos con valores muy bajos o muy altos. En este caso, la distribuci칩n de los valores es aproximadamente sim칠trica, y se reparten alrededor de una mayor칤a de valores centrales.

#### Creaci칩n del histograma en `Python`

Las funciones de histograma de `Python` permiten construir el histograma directamente sin necesidad de hacer previamente una tabla de frecuencias (en realidad, la tabla de frecuencias se calcula internamente). Es mucho m치s sencillo utilizar estas funciones, ya que el c칩digo se simplifica mucho.

Como siempre, presentamos la opci칩n b치sica de R junto con la opci칩n de la funci칩n `ggplot()` de `tidyverse`, y utilizamos las opciones de personalizaci칩n de `ggplot()`para trazar un histograma de aspecto semejante al gr치fico b치sico; en esta ocasi칩n, utilizamos el color de relleno gris.

Vemos que los dos gr치ficos no son id칠nticos a pesar de provenir de los mismos datos, porque la construcci칩n de los intervalos subyacente es ligeramente diferente. Esto no debe preocuparnos, porque el aspecto general de la distribuci칩n de los datos es el mismo.

En la fase de exploraci칩n nos importa m치s entender estas propiedades de los datos (aspecto, forma de la distribuci칩n) que la precisi칩n en la construcci칩n del gr치fico. En todo caso, en `qqplot()`podemos usar infinidad de opciones que nos permiten configurar el gr치fico hasta los m치s m칤nimos detalles, por lo que esta funci칩n es mucho m치s 칰til que las funciones b치sicas para preparar gr치ficos que vayan destinados a informes o presentaciones. La funci칩n b치sica `hist()`, por su parte, es m치s sencilla de usar al principio cuando no tenemos todav칤a experiencia con `ggplot()`, y tambi칠n para una visualizaci칩n r치pida.

### Otros ejemplos

En ocasiones, nos encontramos con datos que son asim칠tricos: hay una mayor칤a de valores bajos o bien de valores altos. Veamos un caso: los recuentos bacterianos de bacterias coliformes, que tenemos en la 칰ltima columna a la derecha de nuestra tabla, en la variable 췂coliformes췂.

![](01-imagenes/camembert-graf-colis.png)

En este caso, vemos que la mayor칤a de los casos tienen valor cero. Es el caso de los recuentos de bacterias contaminantes, en el que la mayor칤a de los an치lisis tienen recuentos cero o muy bajos, y s칩lo en pocos casos tienen valores altos. Veremos con m치s detalle c칩mo tratar estas distribuciones cuando hablemos de las distribuciones de probabilidad, en cap칤tulos posteriores.

En los histogramas de los recuentos bacterianos,utilizamos una opci칩n para aumentar el n칰mero de barras que queremos en el histograma: `breaks=` en la funci칩n base, `bins=` en `ggplot()`:

En casos de distribuciones muy asim칠tricas, a veces es conveniente aplicar una transformaci칩n a los datos, tal como el logaritmo decimal, mediante la funci칩n `log10()`; esto facilita la interpretaci칩n del gr치fico:

## Gr치ficos de densidad

Un gr치fico de densidad en R es una representaci칩n visual suavizada de la distribuci칩n de un conjunto de datos. A diferencia de los histogramas, que dividen los datos en intervalos y cuentan las frecuencias, los gr치ficos de densidad utilizan t칠cnicas estad칤sticas no param칠tricas para estimar la funci칩n de densidad de probabilidad.

Un gr치fico de densidad, tambi칠n conocido como *density plot*, es una representaci칩n visual suavizada de la distribuci칩n de un conjunto de datos.A diferencia de los histogramas, que dividen los datos en intervalos y cuentan las frecuencias, los gr치ficos de densidad utilizan t칠cnicas estad칤sticas no param칠tricas para estimar la funci칩n de densidad de probabilidad de una variable continua. El gr치fico de densidad utiliza suavizamiento para proporcionar una estimaci칩n m치s continua de la distribuci칩n de los datos.

Excel no permite la representaci칩n de los gr치ficos de densidad; en R pueden hacerse con la funci칩n `ggplot()`simplemente a침adiendo la geometr칤a `geom_density()`

Podemos representar simult치neamente el histograma y la funci칩n de densidad; hay que tener en cuenta que para representar la densidad y el histograma superpuestos, nos vemos obligados a cambiar la escala del eje Y a los valores de densidad en vez de a las frecuencias, de manera que los dos gr치ficos puedan solaparse sin problemas.

La ventaja de los gr치ficos de densidad es que como no tenemos que fraccionar los datos en intervalos arbitrarios, no estamos afectados por el efecto visual de la anchura de estos intervalos. Tambi칠n hay otras ventajas desde el punto de vista estad칤stico, que veremos al hablar de las distribuciones de probabilidad.

La flexibilidad de configuraci칩n de los gr치ficos de `qqplot()`permite la personalizaci칩n de los gr치ficos hasta el 칰ltimo detalle. A continuaci칩n vemos un gr치fico de densidad agrupado por meses, que nos muestra aparentes diferencias en el extracto seco `est` seg칰n los meses.

## Diagrama de caja o *boxplot*

Este gr치fico fue creado por el estad칤stico John Tukey en 1977, y es una herramienta fundamental en la exploraci칩n de datos. Se basa en un grupo de medidas que se utiliza ampliamente en la descripci칩n de conjuntos de datos, el conjunto de **cuartiles**. Si dividimos un grupo de datos **ordenados** en cuatro partes iguales, mediante **tres** puntos de corte, llamamos **primer cuartil** o $Q1$ al valor que se situa en el 25%; **segundo cuartil**, o $Q2$, al valor que se sit칰a en el centro (50%), y **tercer cuartil**, o $Q3$, al punto que se situa en el 75% de los datos. A estos tres valores a침adimos el **m칤nimo** y el **m치ximo**, y tenemos un conjunto de **cinco n칰meros** que nos permiten describir la forma de la distribuci칩n de datos con cierta precisi칩n. El segundo cuartil ($Q2$), que corresponde al 50% de los datos, se conoce habitualmente como **mediana**. El valor resultante de restar $Q3-Q1$ es lo que se conoce como **rango intercuartil** o $IQR$, y es una medida de la dispersi칩n de la distribuci칩n de datos (mide la amplitud de la distribuci칩n).

El **diagrama de caja**, tambi칠n conocido como *boxplot*, es un gr치fico que permite resumir las caracter칤sticas principales de un conjunto de datos utilizando estos cinco n칰meros, tal como se explica a continuaci칩n. Sus ventajas son:

-   Muestra la mediana y los cuartiles (Q1 y Q3) de los datos.
-   Permite identificar la simetr칤a de la distribuci칩n: si la mediana no est치 en el centro, la distribuci칩n no es sim칠trica.
-   Permite detectar posibles valores at칤picos, representando los valores at칤picos (*outliers*) que est치n lejos del resto de los datos (un valor es at칤pico si est치 m치s all치 de (Q3 + 1.5 \cdot IQR) o (Q1 - 1.5 \cdot IQR).

La construcci칩n de un diagrama de caja es como sigue:

![](01-imagenes/boxplot.svg)

Microsoft Excel no dispone de un dise침o de gr치ficos de caja que sea pr치ctico, por lo que recurriremos siempre a R para realizarlos.

Como casi siempre, hay una funci칩n de base que dibuja un *boxplot* y tambi칠n una geometr칤a de `ggplot()`que lo hace: `geom_boxplot()`, con muchas m치s opciones de dise침o y formato que la opci칩n de base.

$$
boxplot(df_aula$altura_cm)
$$

#\| label: fig-boxplot2 #\| fig-cap: "Ejemplos de boxplot" #\| fig-subcap: #\| - "Boxplot b치sico de R" #\| - "Boxplot utilizando `ggplot()`" #\| layout-ncol: 2

df_camembert \<- read.csv2("excel-R/camembert.csv",fileEncoding='latin1') df_camembert$fecha <- as.Date(df_camembert$fecha, format("%d/%m/%Y"))

boxplot(df_camembert\$est)

df_camembert \|\> ggplot(aes(x="", y=est))+ geom_boxplot() + theme_bw() + theme(axis.text.x = element_blank(), \# Oculta las etiquetas del eje x axis.ticks.x = element_blank()) \# Oculta las marcas del eje x

Un uso muy interesante del boxplot en R consiste en agrupar los boxplot de una variable en funcion de otra. En este caso, agrupamos el extracto seco por meses previa agrupaci칩n de la fecha. Esta agrupaci칩n puede hacerse tanto en los gr치ficos b치sicos de R como en `ggplot()`:

**Resumen**

El c칩digo realiza las siguientes acciones:

-   A침ade una columna `mes` al dataframe `df_camembert`, que contiene solo el mes extra칤do de la columna `fecha`.
-   Crea un boxplot b치sico que muestra la distribuci칩n de `est` por mes.
-   Utiliza `ggplot2` para crear un boxplot m치s personalizado de `est` por mes, con etiquetas y un tema minimalista para un dise침o limpio.

#\| label: fig-boxplot3 #\| fig-cap: "Ejemplos de boxplot" #\| fig-subcap: #\| - "Boxplot b치sico de R" #\| - "Boxplot utilizando `ggplot()`" #\| layout-ncol: 2

df_camembert$mes <- format(df_camembert$fecha, "%m") boxplot (df_camembert$est~df_camembert$mes)

df_camembert \|\> mutate (mes = format(fecha, "%m")) \|\> ggplot(aes(x = mes, y = est)) + geom_boxplot() + labs(title = "Boxplot de 'est' por Meses", x = "Mes", y = "Valor de est") + theme_minimal()

La agrupaci칩n de los *boxplots* por meses nos pone claramente de manifiesto las diferencias en el extracto seco `est`que ya hab칤amos visto con los gr치ficos de densidad. Estas diferencias son m치s claras en el mes de julio.

### Relaci칩n entre el *boxplot* y el histograma

Resulta muy 칰til comprender visualmente la relaci칩n entre el *boxplot* y el histograma para entender la distribuci칩n de los datos. En la gr치fica siguiente se representan ambos simult치neamente

df_camembert \|\> ggplot(aes(x = est)) + geom_histogram(fill = "lightblue", color = "black", bins = 20, alpha = 0.7) + geom_boxplot(width = 2, fill = "darkgrey", alpha = 0.7, position = position_nudge(y = -2)) + labs(title = "Histograma y Boxplot", y = "Frecuencias")

df_camembert \|\> ggplot(aes(x = log10(coliformes+1))) + geom_histogram(fill = "lightblue", color = "black", bins = 20, alpha = 0.7) + geom_boxplot(width = 4, fill = "darkgrey", alpha = 0.7, position = position_nudge(y = -4)) + labs(title = "Histograma y Boxplot", y = "Frecuencias")

## Gr치ficos de dispersi칩n

Un gr치fico de dispersi칩n, tambi칠n conocido como diagrama de dispersi칩n o *scatter plot*, es una representaci칩n gr치fica que utiliza puntos para mostrar la relaci칩n entre dos variables num칠ricas. Cada punto en el gr치fico representa una observaci칩n del conjunto de datos y se coloca en el plano cartesiano de acuerdo con sus valores en las dos variables que se est치n comparando.

Un gr치fico de dispersi칩n se compone mediante puntos:

-   Cada punto en el gr치fico representa una observaci칩n.
-   La posici칩n del punto en el gr치fico est치 determinada por los valores de las dos variables para esa observaci칩n.

Los gr치ficos de dispersi칩n son 칰tiles para identificar varios aspectos de la relaci칩n entre las dos variables:

-   Si los puntos tienden a agruparse a lo largo de una l칤nea recta ascendente, esto indica una correlaci칩n positiva (a medida que una variable aumenta, la otra tambi칠n lo hace).
-   Si los puntos se agrupan a lo largo de una l칤nea descendente, esto indica una correlaci칩n negativa (a medida que una variable aumenta, la otra disminuye).
-   Si los puntos forman una curva en lugar de una l칤nea recta, esto sugiere una relaci칩n no lineal entre las variables.
-   La dispersi칩n de los puntos puede indicar la variabilidad de los datos. Puntos que est치n muy lejos del patr칩n general pueden ser valores at칤picos.

Como siempre, vemos el gr치fico de dispersi칩n en Excel y a continuaci칩n en R. Utilizamos la tabla de datos `camembert.csv` y representamos las variables `est`y `mg`.

::: {#fig-grafdisp layout-ncol="2"}
![Tabla de origen mostrando una parte de los datos seleccionados](01-imagenes/camembert-tabla-dispersion-est-mg.png){#fig-tabladisp}

![Gr치fico de dispersi칩n](01-imagenes/camembert-dispersion-est-mg.png)

Gr치fico de dispersi칩n en Excel
:::

A continuaci칩n, el c칩digo R para realizar el gr치fico de dispersi칩n, con la funci칩n b치sica y con `ggplot()`.

#\| label: fig-grafdisp #\| fig-cap: "Ejemplos de gr치fico de dispersi칩n" #\| fig-subcap: #\| - "Gr치fico de dispersion b치sico de R" #\| - "Gr치fico de dispersion utilizando `ggplot()`" #\| layout-ncol: 2 #\| plot(df_camembert$est, df_camembert$mg)

df_camembert \|\> ggplot(aes(x=est,y=mg))+ geom_point() + theme_bw()

Lo esperable en nuestros datos es que el valor de `est` y el de `mg` est칠n asociados, y a valores altos de la primera variable correspondan valores altos de la segunda (para el mismo producto y sin cambios de tecnolog칤a). Sin embargo, algunos valores parecen no encajar en este modelo; es el caso de un valor de `est`por encima de 52% con un valor de `mg`inferior a 23%, o el caso de un valor de `mg` en torno al 28% con un valor de `est` por debajo de 47%. Debemos revisar estos valores aparentemente anormales para verificar si ha habido un error en la toma de muestras o un error anal칤tico. En f치bricas con productos diferentes cuyos resultados anal칤ticos se recogen en una tabla de datos com칰n, a veces puede haber errores en la introducci칩n de los c칩digos de producto, de forma que la toma de muestras y los an치lisis pueden ser correctos, pero estar mal asignados al guardar los datos.

Como vemos, los gr치ficos de dispersi칩n son una herramienta esencial en el an치lisis de datos exploratorio, ya que permiten visualizar relaciones y patrones en los datos, identificar correlaciones y detectar posibles anomal칤as. Esta informaci칩n es crucial para realizar an치lisis estad칤sticos m치s profundos y tomar decisiones basadas en datos.

## Gr치ficos de series temporales

Hasta ahora hemos utilizado gr치ficos y tablas que describen la estructura y forma de una variable, o las relaciones entre dos variables. Hay otros gr치ficos que tienen en cuenta la forma en la que esos datos cambian con el tiempo. En este caso, ser치 necesario que hayamos recogido en una variable de nuestra tabla los intervalos de tiempo en los que se han producido nuestros valores.

## Ejemplos de series temporales

쯉e te ocurren algunos ejemplos de series temporales?

## Algunos ejemplos

-   proceso de llenado de envases de queso crema: se llena una tarrina cada 15 segundos. Nuestros datos deben recoger el tiempo y el peso.

-   nuestro fichero de fabricaci칩n de queso camembert recoge los valores anal칤ticos medios diarios del producto fabricado.

-   Una f치brica recoge leche diariamente y analiza cada d칤a la composici칩n de la leche que entra en la f치brica.

En un gr치fico de series temporales,

-   el eje horizontal (X) representa el tiempo. Los puntos de tiempo pueden ser minutos, horas, d칤as, meses, a침os, etc.
-   el eje vertical (Y) representa los valores de la variable que se est치 estudiando. Estos valores pueden ser medidas como temperatura, ventas, precios, etc.
-   cada valor individual corresponde a un punto
-   los valores se conectan mediante una l칤nea que conecta los puntos de datos, mostrando c칩mo cambian los valores de la variable a lo largo del tiempo.
-   normalmente, en un gr치fico de series temporales no suelen representarse los puntos individuales para facilitar la legibilidad del gr치fico.

En nuestro conjunto de datos de fabricaci칩n de queso camembert, la primera columna de la tabla recoge la variable `fecha`, lo que nos permite ordenar nuestros valores en el tiempo.

Cuando representamos valores en el tiempo, nunca usaremos el diagrama de barras, sino el gr치fico de l칤neas.

### C칩mo hacer los gr치ficos de series temporales en Excel y en R

Para hacer el gr치fico en Excel, seleccionamos la columna `est`e insertamos un gr치fico de l칤neas. A continuaci칩n, con el cursor sobre el gr치fico, pulsamos el boton derecho y seleccionamos la opci칩n `Seleccionar datos`. Una vez abierto el cuadro de opciones, editamos las etiquetas del eje X y seleccionamos el rango de la variable `fecha` desde la fila 2 hasta la 칰ltima.Aceptamos, y a continuaci칩n editamos el formato del eje Y para sustituir el valor m칤nimo de $0$ por $42$, que es el valor que queremos como m칤nimo para nuestro gr치fico.

![Tabla y gr치fico de series](01-imagenes/camembert-excel-graf-series.png)

A continuaci칩n, los gr치ficos en R, como siempre con la opci칩n de gr치ficos base y con `ggplot()`. R formatea autom치ticamente el rango del eje Y y no tenemos que hacer ninguna correcci칩n de formato.

#\| label: fig-graftemp #\| fig-cap: "Ejemplos de gr치fico de series temporales" #\| fig-subcap: #\| - "Gr치fico de series temporales b치sico de R" #\| - "Gr치fico de series temporales utilizando `ggplot()`" #\| layout-ncol: 2

plot(df_camembert$fecha, df_camembert$est, type="l")

df_camembert \|\> ggplot(aes(x=fecha, y=est))+ geom_line() + theme_bw()

### Resumen

Los gr치ficos de series temporales son 칰tiles para:

1.  **Identificar Tendencias**:
    -   Una tendencia es una direcci칩n general en la que los datos se mueven a lo largo del tiempo. Puede ser creciente, decreciente o constante.
2.  **Detecci칩n de Estacionalidad**:
    -   La estacionalidad se refiere a patrones que se repiten en intervalos regulares de tiempo, como las ventas de productos estacionales.
3.  **Identificar Ciclos**:
    -   Los ciclos son fluctuaciones que ocurren en intervalos no regulares y pueden deberse a factores econ칩micos o de otra 칤ndole.
4.  **Detecci칩n de Anomal칤as**:
    -   Los picos y ca칤das repentinas pueden indicar eventos inusuales o errores en los datos.

Los gr치ficos de series temporales son cruciales en diversas 치reas:

1.  **Econom칤a y Finanzas**:
    -   Seguimiento de precios de acciones, tasas de inter칠s y otros indicadores econ칩micos.
2.  **Ciencia y Tecnolog칤a**:
    -   Monitoreo de variables ambientales, datos meteorol칩gicos y medidas cient칤ficas.
3.  **Negocios**:
    -   An치lisis de ventas, demanda de productos y desempe침o empresarial a lo largo del tiempo.

Los gr치ficos de series temporales proporcionan una visi칩n clara y concisa de c칩mo cambian los datos a lo largo del tiempo. Esta visualizaci칩n es fundamental para el an치lisis predictivo, la toma de decisiones y la identificaci칩n de patrones y anomal칤as en los datos.

https://tidyplots.org/

![](01-imagenes/1740294003188.jpg) ![](01-imagenes/1740121283445.jpg)